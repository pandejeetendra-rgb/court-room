<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Courtroom Bail GBL — Single-Screen Mobile (v2.4)</title>
  <style>
    :root{
      --bg1:#070b16;
      --bg2:#0b1430;
      --stroke:rgba(255,255,255,.12);
      --ink:#eef3ff;
      --muted:#aebbe0;
      --good:#31d07c;
      --bad:#ff5d6c;
      --gold:#ffd66a;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --r:18px;

      --hudH: 60px;
      --quizH: 290px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1100px 520px at 15% -15%, rgba(106,166,255,.22), transparent 55%),
        radial-gradient(900px 520px at 95% 5%, rgba(255,214,106,.16), transparent 55%),
        radial-gradient(900px 620px at 50% 120%, rgba(49,208,124,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    .app{
      height:100%;
      max-width:1100px;
      margin:0 auto;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    /* HUD */
    .hud{
      height: var(--hudH);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .brand{display:flex; align-items:center; gap:10px; min-width: 240px;}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 55%),
        linear-gradient(135deg, rgba(106,166,255,.95), rgba(49,208,124,.85));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo:after{
      content:"";
      position:absolute; inset:-40% -20%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,.22), transparent);
      transform: rotate(20deg);
      animation: sheen 5s linear infinite;
    }
    @keyframes sheen{0%{transform:translateX(-45%) rotate(20deg)} 100%{transform:translateX(75%) rotate(20deg)}}
    .brand h1{margin:0;font-size:16px;font-weight:900;letter-spacing:.2px}
    .brand p{margin:2px 0 0;font-size:12px;color:var(--muted)}
    .hudRight{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; width:100%;}
    .pill{
      display:flex; align-items:center; gap:7px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      box-shadow: 0 12px 22px rgba(0,0,0,.18);
      backdrop-filter: blur(8px);
    }
    .pill b{font-size:12.5px}
    .pill span{font-size:12px;color:var(--muted);font-weight:700}

    /* Main stage */
    .stage{
      position:relative;
      flex:1 1 auto;
      min-height: 460px;
      border-radius: var(--r);
      border:1px solid var(--stroke);
      background:
        radial-gradient(900px 340px at 50% -10%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(900px 520px at 50% 120%, rgba(0,0,0,.38), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* Scene */
    .scene{position:absolute; inset:0 0 var(--quizH) 0; padding:12px;}
    .sceneInner{
      position:relative;
      height:100%;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(700px 260px at 50% -20%, rgba(106,166,255,.16), transparent 60%),
        linear-gradient(180deg, rgba(15,26,51,.5), rgba(10,16,30,.88));
      overflow:hidden;
    }
    .floor{
      position:absolute; left:-12%; right:-12%; bottom:-42%;
      height:74%;
      background: linear-gradient(180deg, rgba(255,214,106,.14), rgba(255,214,106,.05));
      transform: skewY(-6deg);
      border-top:1px solid rgba(255,255,255,.08);
    }
    .bench{
      position:absolute; top:44px; left:50%;
      transform: translateX(-50%);
      width:min(640px, 92%);
      height:160px;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(106,68,38,.90), rgba(50,28,16,.92));
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 42px rgba(0,0,0,.35);
    }
    .bench:before{
      content:"";
      position:absolute; left:18px; right:18px; top:14px;
      height:28px;
      border-radius: 16px;
      background: linear-gradient(90deg, rgba(255,255,255,.14), rgba(255,255,255,.03));
    }

    .caseLabel{
      position:absolute;
      top:12px; left:12px; right:12px;
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      pointer-events:none;
      z-index: 50;
    }
    .caseBadge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 26px rgba(0,0,0,.25);
      max-width: 72%;
    }
    .caseBadge b{font-size:12.5px}
    .caseBadge span{
      font-size:12px;
      color:var(--muted);
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }

    /* Characters */
    .char{
      position:absolute;
      bottom:86px;
      width:170px;
      height:200px;
      filter: drop-shadow(0 18px 22px rgba(0,0,0,.35));
      transform-origin: 50% 100%;
      z-index: 20;
    }
    .lawyer{left:18px}
    .client{right:18px}

    /* Role labels */
    .roleTag{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top:-14px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.30);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.92);
      font-weight:900;
      font-size:12px;
      letter-spacing:.2px;
      white-space:nowrap;
      box-shadow: 0 12px 22px rgba(0,0,0,.22);
      pointer-events:none;
    }
    .roleTag small{color:var(--muted); font-weight:800; margin-left:6px}
    .roleTag.judge{top:6px}

    @media (max-width: 520px){
      :root{ --quizH: 310px; }
      .char{width:150px;height:185px; bottom:84px}
      .lawyer{left:6px}
      .client{right:6px}
      .bench{top:46px;height:155px}
      .roleTag{font-size:11.5px}
    }

    /* Judge wrap + manner effects */
    .judgeWrap{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top:0;
      width:240px;
      height:240px;
      pointer-events:none;
      filter: drop-shadow(0 18px 22px rgba(0,0,0,.35));
      z-index: 25;
    }
    .judge{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top:10px;
      width:210px;
      height:220px;
      transform-origin: 50% 65%;
    }
    .judgeNod{ animation: nod .55s ease; }
    @keyframes nod{
      0%{transform: translateX(-50%) rotate(0deg) translateY(0)}
      40%{transform: translateX(-50%) rotate(0deg) translateY(3px)}
      70%{transform: translateX(-50%) rotate(0deg) translateY(-1px)}
      100%{transform: translateX(-50%) rotate(0deg) translateY(0)}
    }
    .judgeShake{ animation: shake .55s ease; }
    @keyframes shake{
      0%{transform: translateX(-50%) rotate(0deg)}
      25%{transform: translateX(-50%) rotate(-3deg)}
      50%{transform: translateX(-50%) rotate(3deg)}
      75%{transform: translateX(-50%) rotate(-2deg)}
      100%{transform: translateX(-50%) rotate(0deg)}
    }

    /* Judge gavel arm (hammer effect) */
    .judgeGavel{
      transform-origin: 150px 150px;
    }
    .judgeGavel.strike{
      animation: judgeStrike .45s ease;
    }
    @keyframes judgeStrike{
      0%{transform: rotate(0deg) translateY(0)}
      35%{transform: rotate(-14deg) translateY(-6px)}
      70%{transform: rotate(10deg) translateY(2px)}
      100%{transform: rotate(0deg) translateY(0)}
    }

    /* Gavel (also used as judgment strike) */
    .gavel{
      position:absolute;
      top:88px;
      right:18px;
      width:84px;
      height:84px;
      transform-origin: 60% 60%;
      opacity:.95;
      filter: drop-shadow(0 14px 18px rgba(0,0,0,.35));
      pointer-events:none;
      z-index: 30;
    }
    .gavel.tap{animation: gavelTap .42s ease}
    @keyframes gavelTap{
      0%{transform: rotate(0deg) translateY(0)}
      35%{transform: rotate(-16deg) translateY(-7px)}
      65%{transform: rotate(10deg) translateY(2px)}
      100%{transform: rotate(0deg) translateY(0)}
    }
    .gavelSpark{
      position:absolute;
      right:42px;
      top:128px;
      width:10px;height:10px;
      border-radius: 999px;
      background: rgba(255,214,106,.95);
      box-shadow: 0 0 18px rgba(255,214,106,.85);
      opacity:0;
      pointer-events:none;
      z-index: 31;
    }
    .gavelSpark.show{animation: spark .32s ease}
    @keyframes spark{
      0%{opacity:0; transform: scale(.6)}
      35%{opacity:1; transform: scale(1.8)}
      100%{opacity:0; transform: scale(2.2)}
    }

    /* Scene stamp with seal */
    .stamp{
      position:absolute;
      left:50%;
      top:52%;
      transform: translate(-50%,-50%) rotate(-8deg) scale(.9);
      padding:12px 14px;
      border-radius: 18px;
      border:2px dashed rgba(255,255,255,.35);
      background: rgba(0,0,0,.30);
      font-weight:950;
      letter-spacing: 1px;
      text-transform: uppercase;
      display:none;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      z-index: 70;
      width:min(360px, 92%);
      pointer-events:none;
    }
    .stampRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .stampText{font-size:14px}
    .stampSub{margin-top:6px; font-size:12px; color:var(--muted); font-weight:800; letter-spacing:.2px}
    .stamp.good{color: rgba(49,208,124,.98); border-color: rgba(49,208,124,.8)}
    .stamp.bad{color: rgba(255,93,108,.98); border-color: rgba(255,93,108,.8)}
    .stamp.show{display:block; animation: stampPop .48s ease}
    @keyframes stampPop{
      0%{opacity:0; transform: translate(-50%,-50%) rotate(-14deg) scale(.55)}
      65%{opacity:1; transform: translate(-50%,-50%) rotate(-8deg) scale(1.06)}
      100%{opacity:1; transform: translate(-50%,-50%) rotate(-8deg) scale(1)}
    }
    .seal{ width:74px;height:74px; flex:0 0 auto; opacity:.95; }

    /* Confetti */
    .confetti{position:absolute; inset:0; pointer-events:none; overflow:hidden; display:none; z-index: 72;}
    .confetti.show{display:block}
    .confetti i{position:absolute; top:-10%; width:10px; height:16px; border-radius: 3px; opacity:.92; animation: fall 1.15s linear forwards;}
    @keyframes fall{0%{transform: translateY(-10vh) rotate(0deg); opacity:1} 100%{transform: translateY(120vh) rotate(260deg); opacity:.88}}

    /* Bail: client walks out */
    #clientSvg.walkOut{ animation: walkOut 1.3s ease forwards; }
    @keyframes walkOut{0%{transform: translateX(0) scale(1)} 35%{transform: translateX(-18px) scale(1.02)} 100%{transform: translateX(-180px) scale(1.02); opacity:0}}
    @media (max-width:520px){@keyframes walkOut{0%{transform: translateX(0) scale(1)} 35%{transform: translateX(-14px) scale(1.02)} 100%{transform: translateX(-140px) scale(1.02); opacity:0}}}

    /* ===== CAGE EFFECT ===== */
    .cageWrap{
      position:absolute;
      right:6px;
      bottom:66px;
      width:250px;
      height:280px;
      pointer-events:none;
      opacity:0;
      transform: translateY(-18px) scale(.98);
      z-index: 80;
    }
    @media (max-width:520px){.cageWrap{width:210px;height:250px; right:2px}}
    .cageWrap.show{
      opacity:1;
      transform: translateY(0) scale(1);
      animation: cageIn .28s ease;
    }
    @keyframes cageIn{from{opacity:0; transform: translateY(-18px) scale(.98)} to{opacity:1; transform: translateY(0) scale(1)}}

    .cageFrame{
      position:absolute; inset:0;
      border-radius: 22px;
      background: rgba(0,0,0,.34);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 44px rgba(0,0,0,.46);
      overflow:hidden;
    }

    .cageFlash{
      position:absolute; inset:0;
      background:
        radial-gradient(240px 180px at 25% 15%, rgba(60,150,255,.22), transparent 55%),
        radial-gradient(240px 180px at 75% 15%, rgba(255,80,110,.22), transparent 55%);
      opacity:0;
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .cageWrap.show .cageFlash{ animation: siren 1.15s ease-in-out 1; }
    @keyframes siren{
      0%{opacity:0}
      15%{opacity:1}
      30%{opacity:.25}
      45%{opacity:1}
      60%{opacity:.25}
      75%{opacity:1}
      100%{opacity:0}
    }

    .cageBars{
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(
          90deg,
          rgba(255,255,255,.20) 0,
          rgba(255,255,255,.20) 9px,
          rgba(0,0,0,.22) 9px,
          rgba(0,0,0,.22) 22px
        );
      opacity:.84;
      transform: translateY(-120%);
    }
    .cageWrap.show .cageBars{
      animation: barsDrop .65s cubic-bezier(.2,.85,.2,1) forwards;
    }
    @keyframes barsDrop{to{transform: translateY(0)}}

    .cageTop{
      position:absolute; left:10px; right:10px; top:10px;
      height:20px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 12px 20px rgba(0,0,0,.24);
      opacity:.9;
    }
    .lock{
      position:absolute;
      left:50%;
      top:26px;
      transform: translateX(-50%) scale(.7);
      opacity:0;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.35));
    }
    .cageWrap.show .lock{
      opacity:1;
      animation: lockPop .48s ease .22s forwards;
    }
    @keyframes lockPop{
      0%{transform: translateX(-50%) scale(.55); opacity:0}
      60%{transform: translateX(-50%) scale(1.05); opacity:1}
      100%{transform: translateX(-50%) scale(.95); opacity:1}
    }

    .cageTag{
      position:absolute; left:12px; right:12px; bottom:12px;
      padding:10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.50);
      color: rgba(255,93,108,.95);
      font-weight:950;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 12px;
      text-align:center;
    }
    .cageSmall{
      position:absolute;
      left:12px; right:12px;
      bottom:46px;
      padding:8px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-weight:800;
      font-size:12px;
      text-align:center;
      opacity:.95;
    }

    .clang{
      position:absolute;
      left:50%;
      top:36%;
      transform: translate(-50%,-50%) scale(.7);
      opacity:0;
      padding:8px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.45);
      font-weight:950;
      letter-spacing: 1px;
      color: rgba(255,214,106,.9);
      z-index: 85;
      pointer-events:none;
    }
    .cageWrap.show .clang{
      animation: clangPop .70s ease .16s forwards;
    }
    @keyframes clangPop{
      0%{opacity:0; transform: translate(-50%,-50%) scale(.7)}
      45%{opacity:1; transform: translate(-50%,-50%) scale(1.08)}
      100%{opacity:0; transform: translate(-50%,-50%) scale(1.22)}
    }

    /* Quiz panel */
    .quiz{
      position:absolute;
      left:0; right:0; bottom:0;
      height: var(--quizH);
      border-top:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 240px at 20% 0%, rgba(106,166,255,.12), transparent 60%),
        radial-gradient(900px 240px at 80% 0%, rgba(255,214,106,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.28));
      backdrop-filter: blur(10px);
      padding:12px;
      z-index: 90;
    }
    .quizTop{display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap;}
    .quizTop h2{margin:0;font-size:14px;font-weight:950;letter-spacing:.2px}
    .quizTop p{margin:6px 0 0;color:var(--muted);font-size:12.5px;line-height:1.35}
    .btnRow{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}

    .btn{
      appearance:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.07);
      color:var(--ink);
      padding:9px 11px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:850;
      letter-spacing:.2px;
      transition: transform .06s ease, background .18s ease, border-color .18s ease;
      user-select:none;
    }
    .btn:hover{background: rgba(255,255,255,.10)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(106,166,255,.95), rgba(49,208,124,.85));
      border-color: rgba(255,255,255,.18);
      color:#061021;
    }
    .btn.warn{
      background: linear-gradient(135deg, rgba(255,214,106,.95), rgba(255,120,106,.85));
      border-color: rgba(255,255,255,.18);
      color:#1a0c05;
    }
    .btn:disabled{opacity:.55; cursor:not-allowed; transform:none}

    .qBox{
      margin-top:10px;
      padding:12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
    }
    .qText{margin:0;font-size:14px;font-weight:850;line-height:1.35}
    .meta{margin:8px 0 0;font-size:12px;color:var(--muted);font-weight:700}

    .options{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width:520px){.options{grid-template-columns:1fr}}
    .opt{
      text-align:left;
      padding:12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      transition: background .18s ease, transform .06s ease, border-color .18s ease;
      font-weight:850;
      color:var(--ink);
      min-height: 52px;
    }
    .opt:hover{background: rgba(255,255,255,.10)}
    .opt:active{transform: translateY(1px)}
    .opt small{display:block;margin-top:6px;color:var(--muted);font-weight:700;line-height:1.35;font-size:12px}
    .opt.correct{border-color: rgba(49,208,124,.75); background: rgba(49,208,124,.10)}
    .opt.wrong{border-color: rgba(255,93,108,.75); background: rgba(255,93,108,.10)}

    /* Verdict screen */
    .verdictScreen{
      position:absolute;
      inset:0;
      background:
        radial-gradient(700px 300px at 50% 0%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.52), rgba(0,0,0,.78));
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      z-index: 120;
    }
    .verdictScreen.show{display:flex}
    .verdictCard{
      width:min(680px, 96%);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,20,40,.62);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 50px rgba(0,0,0,.45);
      overflow:hidden;
      position:relative;
    }
    .verdictTop{
      padding:14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .verdictTop h2{margin:0;font-size:16px;font-weight:950;letter-spacing:.2px}
    .verdictTop p{margin:6px 0 0;color:var(--muted);font-size:12.5px;line-height:1.35}
    .verdictBody{padding:14px;border-top:1px solid rgba(255,255,255,.10);display:grid;gap:10px}
    .feedbackBox{
      padding:12px;border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size:12.5px;
      line-height:1.4;
    }
    .verdictActions{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; padding:14px; border-top:1px solid rgba(255,255,255,.10)}
    .sealCorner{
      position:absolute;
      right:14px;
      bottom:64px;
      width:86px;
      height:86px;
      opacity:.92;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.35));
      pointer-events:none;
      transform: rotate(-8deg);
    }

    /* Intro overlay */
    .intro{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
      z-index: 130;
      background:
        radial-gradient(800px 340px at 50% 0%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.52), rgba(0,0,0,.80));
    }
    .introCard{
      width:min(760px, 96%);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,20,40,.62);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 50px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .introTop{padding:14px}
    .introTop h2{margin:0;font-size:16px;font-weight:950}
    .introTop p{margin:8px 0 0;color:var(--muted);font-size:12.5px;line-height:1.45}
    .introBody{padding:14px;border-top:1px solid rgba(255,255,255,.10);display:grid;gap:10px}
    .ruleBox{
      padding:12px;border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color:var(--muted);
      font-size:12.5px;
      line-height:1.45;
    }
    .introActions{padding:14px;border-top:1px solid rgba(255,255,255,.10);display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.14);
      color:var(--ink);
      padding:10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      display:none;
      backdrop-filter: blur(8px);
      font-weight:900;
      letter-spacing:.2px;
      z-index: 200;
    }
    .toast.show{display:block; animation: toastIn .22s ease}
    @keyframes toastIn{from{opacity:0; transform: translateX(-50%) translateY(8px)} to{opacity:1; transform: translateX(-50%) translateY(0)}}

    @media (prefers-reduced-motion: reduce){
      *{animation:none !important; transition:none !important}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="hud">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Courtroom Bail GBL</h1>
          <p>IT Act quiz (single-screen). One attempt per question.</p>
        </div>
      </div>

      <div class="hudRight">
        <div class="pill"><b>Case</b> <span id="hudCase">0 / 10</span></div>
        <div class="pill"><b>Score</b> <span id="hudScore">0</span></div>
        <div class="pill"><b>Bails</b> <span id="hudBails">0</span></div>
      </div>
    </div>

    <div class="stage">

      <div class="scene">
        <div class="sceneInner">
          <div class="caseLabel">
            <div class="caseBadge">
              <b id="caseNo">Case #1</b>
              <span id="caseBrief">Case brief will appear here.</span>
            </div>
          </div>

          <div class="bench"></div>

          <!-- Judge + label -->
          <div class="judgeWrap" aria-hidden="true">
            <div class="roleTag judge">Judge <small>(Court)</small></div>

            <svg class="judge" id="judgeSvg" viewBox="0 0 220 240">
              <defs>
                <linearGradient id="jg_robe" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#222433" stop-opacity=".98"/>
                  <stop offset="1" stop-color="#0d0e14" stop-opacity=".96"/>
                </linearGradient>
                <radialGradient id="jg_face" cx=".35" cy=".35" r=".75">
                  <stop offset="0" stop-color="#ffffff" stop-opacity=".35"/>
                  <stop offset=".55" stop-color="#e6d4bf" stop-opacity=".96"/>
                  <stop offset="1" stop-color="#bda88d" stop-opacity=".92"/>
                </radialGradient>
                <linearGradient id="jg_wig" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#f5f5ff" stop-opacity=".98"/>
                  <stop offset="1" stop-color="#cfd2ee" stop-opacity=".86"/>
                </linearGradient>
                <linearGradient id="jg_wood" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="rgba(255,214,106,.60)"/>
                  <stop offset="1" stop-color="rgba(255,214,106,.18)"/>
                </linearGradient>
              </defs>

              <!-- wig -->
              <path d="M60 52 C60 25, 160 25, 160 52
                       C170 60, 178 78, 170 96
                       C162 110, 58 110, 50 96
                       C40 78, 48 60, 60 52Z"
                    fill="url(#jg_wig)" opacity=".95"/>
              <!-- face -->
              <circle cx="110" cy="78" r="32" fill="url(#jg_face)" stroke="rgba(0,0,0,.14)" stroke-width="1"/>
              <circle cx="98" cy="76" r="3.2" fill="rgba(0,0,0,.45)"/>
              <circle cx="122" cy="76" r="3.2" fill="rgba(0,0,0,.45)"/>
              <path d="M98 92 Q110 102 122 92" fill="none" stroke="rgba(0,0,0,.35)" stroke-width="2" stroke-linecap="round"/>

              <!-- robe -->
              <path d="M70 112
                       C78 104, 92 98, 110 98
                       C128 98, 142 104, 150 112
                       L166 196
                       C140 214, 80 214, 54 196Z"
                    fill="url(#jg_robe)" stroke="rgba(255,255,255,.08)" stroke-width="1.2"/>
              <rect x="86" y="140" width="48" height="8" rx="8" fill="rgba(255,214,106,.85)" opacity=".65"/>

              <!-- Judge gavel in-hand (hammer effect) -->
              <g id="judgeGavel" class="judgeGavel">
                <rect x="140" y="134" width="34" height="18" rx="6"
                      fill="url(#jg_wood)" stroke="rgba(255,255,255,.12)" stroke-width="1"/>
                <rect x="153" y="142" width="46" height="12" rx="10"
                      fill="url(#jg_wood)" stroke="rgba(255,255,255,.10)" stroke-width="1"
                      transform="rotate(32 153 142)"/>
              </g>
            </svg>
          </div>

          <!-- Lawyer + label -->
          <div class="char lawyer" aria-hidden="true">
            <div class="roleTag">Lawyer <small>(Defence)</small></div>
            <svg viewBox="0 0 180 220" width="100%" height="100%">
              <defs>
                <radialGradient id="lw_face" cx=".35" cy=".35" r=".75">
                  <stop offset="0" stop-color="#ffffff" stop-opacity=".30"/>
                  <stop offset=".55" stop-color="#ead7c2" stop-opacity=".96"/>
                  <stop offset="1" stop-color="#c3a78a" stop-opacity=".92"/>
                </radialGradient>
                <linearGradient id="lw_suit" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#7db7ff" stop-opacity=".98"/>
                  <stop offset="1" stop-color="#2b4aa7" stop-opacity=".92"/>
                </linearGradient>
                <linearGradient id="lw_hair" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#23263a" stop-opacity=".95"/>
                  <stop offset="1" stop-color="#0e0f16" stop-opacity=".95"/>
                </linearGradient>
              </defs>
              <rect x="110" y="140" width="38" height="52" rx="10" fill="rgba(255,214,106,.85)" opacity=".65" stroke="rgba(255,255,255,.10)"/>
              <circle cx="78" cy="70" r="26" fill="url(#lw_face)" stroke="rgba(0,0,0,.12)"/>
              <path d="M52 72 C54 45, 102 42, 106 70
                       C98 58, 78 54, 60 62
                       C56 66, 54 70, 52 72Z"
                    fill="url(#lw_hair)" opacity=".98"/>
              <path d="M40 102
                       C50 92, 64 86, 78 86
                       C92 86, 106 92, 116 102
                       L132 198
                       C104 214, 52 214, 24 198Z"
                    fill="url(#lw_suit)" stroke="rgba(255,255,255,.10)" stroke-width="1.2"/>
              <path d="M78 98 L88 118 L78 132 L68 118 Z" fill="rgba(255,255,255,.22)"/>
              <path d="M78 132 L90 180 L66 180 Z" fill="rgba(255,255,255,.14)"/>
            </svg>
          </div>

          <!-- Client + label -->
          <div class="char client" aria-hidden="true">
            <div class="roleTag">Client <small>(Accused)</small></div>
            <svg id="clientSvg" viewBox="0 0 180 220" width="100%" height="100%">
              <defs>
                <radialGradient id="cl_face" cx=".35" cy=".35" r=".75">
                  <stop offset="0" stop-color="#ffffff" stop-opacity=".30"/>
                  <stop offset=".55" stop-color="#ead7c2" stop-opacity=".96"/>
                  <stop offset="1" stop-color="#c3a78a" stop-opacity=".92"/>
                </radialGradient>
                <linearGradient id="cl_shirt" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#ff86a4" stop-opacity=".92"/>
                  <stop offset="1" stop-color="#7b2140" stop-opacity=".88"/>
                </linearGradient>
                <linearGradient id="cl_hair" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#2a2a2f" stop-opacity=".95"/>
                  <stop offset="1" stop-color="#0f0f14" stop-opacity=".95"/>
                </linearGradient>
              </defs>
              <circle cx="100" cy="72" r="26" fill="url(#cl_face)" stroke="rgba(0,0,0,.12)"/>
              <path d="M78 72 C80 46, 128 44, 130 72
                       C118 58, 96 56, 82 64
                       C80 66, 79 69, 78 72Z"
                    fill="url(#cl_hair)" opacity=".98"/>
              <path d="M62 102
                       C72 92, 86 86, 100 86
                       C114 86, 128 92, 138 102
                       L154 198
                       C126 214, 74 214, 46 198Z"
                    fill="url(#cl_shirt)" stroke="rgba(255,255,255,.10)" stroke-width="1.2"/>
              <circle cx="62" cy="152" r="10" fill="rgba(234,215,194,.92)" opacity=".95"/>
              <circle cx="144" cy="152" r="10" fill="rgba(234,215,194,.92)" opacity=".95"/>
            </svg>
          </div>

          <!-- UI gavel -->
          <svg class="gavel" id="gavel" viewBox="0 0 120 120" aria-hidden="true">
            <defs>
              <linearGradient id="gv" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="#ffd66a" stop-opacity=".70"/>
                <stop offset="1" stop-color="#ffd66a" stop-opacity=".18"/>
              </linearGradient>
            </defs>
            <rect x="18" y="26" width="42" height="24" rx="8" fill="url(#gv)" stroke="rgba(255,255,255,.14)"/>
            <rect x="40" y="42" width="60" height="18" rx="12" fill="url(#gv)" stroke="rgba(255,255,255,.12)"
                  transform="rotate(35 40 42)"/>
          </svg>
          <div class="gavelSpark" id="gavelSpark"></div>

          <!-- Scene stamp -->
          <div class="stamp" id="stamp"></div>

          <div class="confetti" id="confetti"></div>

          <!-- CAGE overlay -->
          <div class="cageWrap" id="cageWrap" aria-hidden="true">
            <div class="clang">CLANG</div>
            <div class="cageFrame">
              <div class="cageFlash"></div>
              <div class="cageTop"></div>
              <div class="cageBars"></div>

              <svg class="lock" viewBox="0 0 120 120" aria-hidden="true">
                <defs>
                  <linearGradient id="lk" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0" stop-color="rgba(255,255,255,.30)"/>
                    <stop offset="1" stop-color="rgba(255,255,255,.10)"/>
                  </linearGradient>
                </defs>
                <path d="M40 54 v-8 a20 20 0 0 1 40 0 v8"
                      fill="none" stroke="rgba(255,214,106,.55)" stroke-width="8" stroke-linecap="round"/>
                <rect x="34" y="54" width="52" height="50" rx="14" fill="rgba(0,0,0,.25)" stroke="url(#lk)" stroke-width="3"/>
                <circle cx="60" cy="78" r="7" fill="rgba(255,214,106,.55)"/>
                <rect x="57" y="82" width="6" height="14" rx="3" fill="rgba(255,214,106,.55)"/>
              </svg>

              <div class="cageSmall">Remand executed</div>
              <div class="cageTag">Judicial Custody</div>
            </div>
          </div>

          <div class="floor"></div>
        </div>
      </div>

      <!-- Quiz -->
      <div class="quiz">
        <div class="quizTop">
          <div>
            <h2 id="quizTitle">Ready</h2>
            <p id="quizSub">Start the hearings. One attempt per question.</p>
          </div>
          <div class="btnRow">
            <button class="btn" id="btnSound">Sound: On</button>
            <button class="btn" id="btnRestart">Restart</button>
            <button class="btn warn" id="btnExport">Export Log</button>
          </div>
        </div>

        <div class="qBox">
          <p class="qText" id="qText">Press “Start” to begin.</p>
          <div class="meta" id="qMeta">Topic: — • Difficulty: — • Question ID: —</div>

          <div class="options" id="options"></div>

          <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
            <button class="btn primary" id="btnStart">Start</button>
          </div>
        </div>
      </div>

      <!-- Verdict screen -->
      <div class="verdictScreen" id="verdictScreen" role="dialog" aria-modal="true">
        <div class="verdictCard">
          <div class="verdictTop">
            <div>
              <h2 id="verdictTitle">Judgment</h2>
              <p id="verdictLine">Result will appear here.</p>
            </div>
            <div class="pill" style="margin-left:auto">
              <b>Points</b> <span id="verdictPoints">0</span>
            </div>
          </div>

          <div class="verdictBody">
            <div class="feedbackBox" id="verdictFeedback">Feedback appears here.</div>
          </div>

          <svg class="sealCorner" viewBox="0 0 120 120" aria-hidden="true">
            <defs>
              <radialGradient id="sg" cx=".35" cy=".35" r=".75">
                <stop offset="0" stop-color="rgba(255,255,255,.22)"/>
                <stop offset=".55" stop-color="rgba(255,214,106,.40)"/>
                <stop offset="1" stop-color="rgba(255,214,106,.12)"/>
              </radialGradient>
            </defs>
            <circle cx="60" cy="60" r="48" fill="none" stroke="rgba(255,214,106,.55)" stroke-width="6"/>
            <circle cx="60" cy="60" r="36" fill="url(#sg)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>
            <path d="M60 36 L67 54 L86 54 L70 65 L76 84 L60 73 L44 84 L50 65 L34 54 L53 54 Z"
                  fill="rgba(255,255,255,.18)" stroke="rgba(255,255,255,.14)" stroke-width="1.5"/>
            <text x="60" y="104" text-anchor="middle" font-size="12" font-weight="900" fill="rgba(255,214,106,.85)">COURT SEAL</text>
          </svg>

          <div class="verdictActions">
            <button class="btn primary" id="btnNext">Next Case</button>
          </div>
        </div>
      </div>

      <!-- Intro overlay -->
      <div class="intro" id="intro">
        <div class="introCard">
          <div class="introTop">
            <h2>Bail or Custody</h2>
            <p>
              You are the defence lawyer. Each hearing has one MCQ based on the IT Act chapter.
              Correct grants bail; wrong sends the client to custody. Aim for maximum bails.
            </p>
          </div>
          <div class="introBody">
            <div class="ruleBox">
              <b>Rules</b><br/>
              • One attempt per question (no appeal).<br/>
              • Correct: +10 points and bail granted.<br/>
              • Wrong: 0 points and custody executed (cage lock).<br/>
              • Scene + MCQ stay on the same screen for smartphones.
            </div>
            <div class="ruleBox">
              <b>Player Comfort</b><br/>
              Animations are intentionally slower so the learner can notice the court outcome.
              You can tune speed from a single timing section in code.
            </div>
          </div>
          <div class="introActions">
            <button class="btn primary" id="btnIntroStart">Start Hearings</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="toast" id="toast">OK</div>

  <script>
    // ===== CONFIG =====
    const TOTAL_CASES = 10;

    // ===== TIMING (slower outcome so learners can feel Bail / Custody) =====
    // You can tune these three values only.
    const TIMING = {
      judgeStrikeAfterMs: 220,   // when judge uses hammer after your selection
      showOutcomeFxMs: 1600,     // keep Bail/Custody outcome visible before verdict overlay
      enableNextAfterMs: 1400    // prevent rushing to the next question
    };

    // MCQs (as implemented)
    const QUESTION_BANK = [
      { id:"ITACT-Q1", topic:"Overview", difficulty:1, brief:"The judge asks a basic fact about the IT Act.",
        q:"The Information Technology Act, 2000 came into force on:",
        choices:["17 Oct 2000","15 Aug 2000","26 Jan 2001","23 Dec 2008"],
        answerIndex:0,
        feedbackCorrect:"Correct. The chapter states the Act came into force on 17 Oct 2000.",
        feedbackWrong:"Incorrect. The chapter mentions 17 Oct 2000 as the enforcement date."
      },
      { id:"ITACT-Q2", topic:"Structure", difficulty:1, brief:"The court checks your knowledge of the Act’s structure.",
        q:"The IT Act, 2000 consists of:",
        choices:["13 Chapters and 94 sections","10 Chapters and 100 sections","14 Chapters and 80 sections","12 Chapters and 96 sections"],
        answerIndex:0,
        feedbackCorrect:"Correct. The chapter notes 13 Chapters divided into 94 sections.",
        feedbackWrong:"Incorrect. The chapter states 13 Chapters divided into 94 sections."
      },
      { id:"ITACT-Q3", topic:"Applicability", difficulty:2, brief:"The judge asks where the Act applies.",
        q:"The IT Act extends to:",
        choices:["Whole of India including Jammu and Kashmir","Only metropolitan cities","Only Union Territories","Only states excluding Jammu and Kashmir"],
        answerIndex:0,
        feedbackCorrect:"Correct. The chapter explicitly includes Jammu and Kashmir.",
        feedbackWrong:"Incorrect. The chapter says it extends to the whole of India including Jammu and Kashmir."
      },
      { id:"ITACT-Q4", topic:"Extra-territorial reach", difficulty:2, brief:"A cross-border scenario is raised in court.",
        q:"The Act can apply to offences committed outside India if:",
        choices:["The person is an Indian citizen only","The act involves a computer system/network located in India","A paper document exists as evidence","The offence is reported within 24 hours"],
        answerIndex:1,
        feedbackCorrect:"Correct. Applicability extends if it involves a computer resource located in India.",
        feedbackWrong:"Incorrect. The key condition is involvement of a computer/system/network located in India."
      },
      { id:"ITACT-Q5", topic:"Objects & Reasons", difficulty:2, brief:"The judge asks the main purpose of the Act.",
        q:"A primary objective of the IT Act, 2000 is to provide legal recognition for:",
        choices:["Handwritten contracts only","Electronic records and electronic transactions","Only criminal trials in cybercrime cases","Only banking regulations"],
        answerIndex:1,
        feedbackCorrect:"Correct. The Act recognizes electronic records and electronic transactions.",
        feedbackWrong:"Incorrect. The Act’s purpose includes recognition for electronic records and e-transactions."
      },
      { id:"ITACT-Q6", topic:"Exceptions", difficulty:3, brief:"The prosecution challenges applicability of the Act to certain documents.",
        q:"Which of the following is an exception where the IT Act does NOT apply?",
        choices:["Will (testamentary disposition)","Electronic records generally","Digital signatures","E-governance services"],
        answerIndex:0,
        feedbackCorrect:"Correct. A 'Will' is listed as an exception category.",
        feedbackWrong:"Incorrect. The chapter lists 'Will' among the exceptions."
      },
      { id:"ITACT-Q7", topic:"Digital Signature", difficulty:2, brief:"The judge checks your understanding of digital signatures.",
        q:"In the chapter, 'Digital signature' is described as authentication of an electronic record by:",
        choices:["A subscriber using an electronic method/procedure","A judge using court seal only","A network provider using firewall logs","A police officer using a warrant"],
        answerIndex:0,
        feedbackCorrect:"Correct. Authentication is by a subscriber via electronic method/procedure.",
        feedbackWrong:"Incorrect. It refers to authentication by a subscriber via an electronic method/procedure."
      },
      { id:"ITACT-Q8", topic:"Amendment 2008", difficulty:3, brief:"The court asks why amendments were needed.",
        q:"According to the chapter, the 2008 amendment was needed mainly because:",
        choices:["Cyber crime was not adequately addressed in the 2000 Act","The Act banned all e-commerce","Digital signatures were removed","All offences became non-bailable"],
        answerIndex:0,
        feedbackCorrect:"Correct. It was needed because cyber crimes were not sufficiently addressed earlier.",
        feedbackWrong:"Incorrect. The key reason described is cyber crimes were not adequately addressed earlier."
      },
      { id:"ITACT-Q9", topic:"Section 43A", difficulty:3, brief:"A data privacy negligence issue is raised.",
        q:"Section 43A concerns liability of a body corporate when it is negligent in:",
        choices:["Maintaining reasonable security practices leading to wrongful loss/gain","Providing free internet access to citizens","Publishing all contracts in paper form only","Running antivirus scans daily"],
        answerIndex:0,
        feedbackCorrect:"Correct. It covers negligence in reasonable security practices resulting in loss/gain.",
        feedbackWrong:"Incorrect. It is about negligence in reasonable security practices and resulting loss/gain."
      },
      { id:"ITACT-Q10", topic:"Investigation powers", difficulty:3, brief:"The judge asks who can investigate/raid for cyber offences.",
        q:"After amendment, offences can be investigated and raids conducted by a police officer of at least the rank of:",
        choices:["Police Inspector","Constable","Superintendent of Police only","Deputy Commissioner only"],
        answerIndex:0,
        feedbackCorrect:"Correct. Rank lowered to Police Inspector (as described).",
        feedbackWrong:"Incorrect. The described amended rank is Police Inspector."
      }
    ];

    const CASE_TEMPLATES = [
      "The accused requests bail. The prosecution claims a risk of repeating the offence.",
      "The accused is a first-time offender. The court seeks clarity on a relevant concept.",
      "A legal-tech issue is cited. You must respond using the IT Act correctly.",
      "The judge tests your reasoning before granting bail.",
      "A procedural concern is raised. Bail depends on your legal clarity."
    ];

    // ===== STATE =====
    const state = {
      totalCases: TOTAL_CASES,
      started: false,
      index: 0,
      score: 0,
      bails: 0,
      current: null,
      attemptLog: [],
      locked: false,
      soundOn: true
    };

    // ===== DOM =====
    const $ = (id) => document.getElementById(id);
    function must(id){
      const node = $(id);
      if(!node) throw new Error("Missing element id: " + id);
      return node;
    }

    const hudCase = must("hudCase");
    const hudScore = must("hudScore");
    const hudBails = must("hudBails");

    const caseNo = must("caseNo");
    const caseBrief = must("caseBrief");

    const quizTitle = must("quizTitle");
    const quizSub = must("quizSub");

    const qText = must("qText");
    const qMeta = must("qMeta");
    const options = must("options");

    const btnSound = must("btnSound");
    const btnStart = must("btnStart");
    const btnRestart = must("btnRestart");
    const btnExport = must("btnExport");

    const intro = must("intro");
    const btnIntroStart = must("btnIntroStart");

    const gavel = must("gavel");
    const gavelSpark = must("gavelSpark");

    const judgeSvg = must("judgeSvg");
    const judgeGavel = must("judgeGavel");

    const stamp = must("stamp");
    const confetti = must("confetti");

    const cageWrap = must("cageWrap");
    const clientSvg = must("clientSvg");

    const verdictScreen = must("verdictScreen");
    const verdictTitle = must("verdictTitle");
    const verdictLine = must("verdictLine");
    const verdictPoints = must("verdictPoints");
    const verdictFeedback = must("verdictFeedback");
    const btnNext = must("btnNext");

    const toast = must("toast");

    // ===== SOUND =====
    let audioCtx = null;
    function ensureAudio(){
      if(!state.soundOn) return null;
      if(!audioCtx){
        try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
        catch(e){ audioCtx = null; }
      }
      return audioCtx;
    }

    function gavelSound(){
      const ctx = ensureAudio();
      if(!ctx) return;

      const now = ctx.currentTime;
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = "sine";
      o.frequency.setValueAtTime(220, now);
      o.frequency.exponentialRampToValueAtTime(140, now + 0.06);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.22, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.09);
      o.connect(g); g.connect(ctx.destination);
      o.start(now); o.stop(now + 0.10);

      const o2 = ctx.createOscillator();
      const g2 = ctx.createGain();
      o2.type = "triangle";
      o2.frequency.setValueAtTime(900, now);
      g2.gain.setValueAtTime(0.0001, now);
      g2.gain.exponentialRampToValueAtTime(0.08, now + 0.005);
      g2.gain.exponentialRampToValueAtTime(0.0001, now + 0.035);
      o2.connect(g2); g2.connect(ctx.destination);
      o2.start(now); o2.stop(now + 0.04);
    }

    function cageClangSound(){
      const ctx = ensureAudio();
      if(!ctx) return;
      const now = ctx.currentTime;

      const o1 = ctx.createOscillator();
      const o2 = ctx.createOscillator();
      const g = ctx.createGain();

      o1.type = "sine"; o2.type = "sine";
      o1.frequency.setValueAtTime(520, now);
      o2.frequency.setValueAtTime(610, now);

      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.18, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.25);

      o1.connect(g); o2.connect(g);
      g.connect(ctx.destination);
      o1.start(now); o2.start(now);
      o1.stop(now + 0.26); o2.stop(now + 0.26);
    }

    // ===== HELPERS =====
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1100);
    }

    function escapeHTML(str){
      const s = String(str);
      return s
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }

    function tapGavelUI(){
      gavel.classList.remove("tap");
      gavelSpark.classList.remove("show");
      void gavel.offsetWidth;
      gavel.classList.add("tap");
      gavelSpark.classList.add("show");
    }

    function judgeStrike(){
      // Judge uses hammer
      judgeGavel.classList.remove("strike");
      void judgeGavel.getBBox(); // force reflow for SVG
      judgeGavel.classList.add("strike");

      // UI gavel echoes the strike for stronger feel
      tapGavelUI();
      gavelSound();
    }

    function judgeManner(correct){
      judgeSvg.classList.remove("judgeNod","judgeShake");
      void judgeSvg.offsetWidth;
      judgeSvg.classList.add(correct ? "judgeNod" : "judgeShake");
    }

    function resetSceneFX(){
      stamp.className = "stamp";
      stamp.innerHTML = "";
      confetti.className = "confetti";
      confetti.innerHTML = "";
      cageWrap.classList.remove("show");
      clientSvg.classList.remove("walkOut");
      state.locked = false;

      const btns = options.querySelectorAll(".opt");
      for(const b of btns){
        b.classList.remove("correct","wrong");
        b.disabled = false;
        const sm = b.querySelector("small");
        if(sm) sm.textContent = "Tap to submit";
      }
    }

    function sealSVG(labelTop, labelBottom){
      return `
        <svg class="seal" viewBox="0 0 120 120" aria-hidden="true">
          <defs>
            <radialGradient id="sealG" cx=".35" cy=".35" r=".75">
              <stop offset="0" stop-color="rgba(255,255,255,.22)"/>
              <stop offset=".55" stop-color="rgba(255,214,106,.40)"/>
              <stop offset="1" stop-color="rgba(255,214,106,.12)"/>
            </radialGradient>
          </defs>
          <circle cx="60" cy="60" r="48" fill="none" stroke="rgba(255,214,106,.55)" stroke-width="6"/>
          <circle cx="60" cy="60" r="36" fill="url(#sealG)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>
          <path d="M60 36 L67 54 L86 54 L70 65 L76 84 L60 73 L44 84 L50 65 L34 54 L53 54 Z"
                fill="rgba(255,255,255,.18)" stroke="rgba(255,255,255,.14)" stroke-width="1.5"/>
          <text x="60" y="22" text-anchor="middle" font-size="10.5" font-weight="900" fill="rgba(255,214,106,.9)">${labelTop}</text>
          <text x="60" y="106" text-anchor="middle" font-size="10.5" font-weight="900" fill="rgba(255,214,106,.9)">${labelBottom}</text>
        </svg>
      `;
    }

    function popStamp(isGood){
      stamp.className = "stamp " + (isGood ? "good" : "bad") + " show";
      const big = isGood ? "BAIL GRANTED" : "JUDICIAL CUSTODY";
      const sub = isGood ? "Order: Release on conditions" : "Order: Remand executed";
      const seal = sealSVG("COURT", "SEAL");
      stamp.innerHTML = `
        <div class="stampRow">
          <div>
            <div class="stampText">${big}</div>
            <div class="stampSub">${sub}</div>
          </div>
          ${seal}
        </div>
      `;
    }

    function fireConfetti(){
      confetti.innerHTML = "";
      const pieces = 26;
      for(let i=0;i<pieces;i++){
        const p = document.createElement("i");
        p.style.left = (Math.random()*100) + "%";
        p.style.animationDelay = (Math.random()*0.12) + "s";
        const hue = Math.floor(Math.random()*360);
        p.style.background = "hsla(" + hue + ", 85%, 65%, .95)";
        p.style.width = (8 + Math.random()*6) + "px";
        p.style.height = (10 + Math.random()*10) + "px";
        confetti.appendChild(p);
      }
      confetti.classList.add("show");
      setTimeout(() => confetti.classList.remove("show"), 1600);
    }

    function showVerdictScreen(){ verdictScreen.classList.add("show"); }
    function hideVerdictScreen(){ verdictScreen.classList.remove("show"); }

    function updateHUD(){
      const caseText = state.started ? ((state.index + 1) + " / " + state.totalCases) : ("0 / " + state.totalCases);
      hudCase.textContent = caseText;
      hudScore.textContent = String(state.score);
      hudBails.textContent = String(state.bails);
    }

    function genBrief(){ return CASE_TEMPLATES[state.index % CASE_TEMPLATES.length]; }
    function pickQuestion(){ return QUESTION_BANK[state.index % QUESTION_BANK.length]; }

    function logAttempt(entry){
      state.attemptLog.push({ ts: new Date().toISOString(), ...entry });
    }

    function downloadJSON(filename, obj){
      const blob = new Blob([JSON.stringify(obj, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(() => URL.revokeObjectURL(a.href), 800);
    }

    // ===== FLOW =====
    function resetGame(){
      state.started = false;
      state.index = 0;
      state.score = 0;
      state.bails = 0;
      state.current = null;
      state.attemptLog = [];
      state.locked = false;

      hideVerdictScreen();
      intro.style.display = "flex";

      quizTitle.textContent = "Ready";
      quizSub.textContent = "Start the hearings. One attempt per question.";
      qText.textContent = "Press “Start” to begin.";
      qMeta.textContent = "Topic: — • Difficulty: — • Question ID: —";
      options.innerHTML = "";

      btnStart.textContent = "Start";
      btnStart.disabled = false;

      caseNo.textContent = "Case #1";
      caseBrief.textContent = "Case brief will appear here.";

      btnNext.textContent = "Next Case";
      btnNext.disabled = false;

      updateHUD();
      resetSceneFX();
    }

    function startGame(){
      state.started = true;
      state.index = 0;
      state.score = 0;
      state.bails = 0;
      state.attemptLog = [];
      intro.style.display = "none";
      nextCase();
    }

    function nextCase(){
      hideVerdictScreen();
      resetSceneFX();

      btnNext.disabled = false;

      if(state.index >= state.totalCases){
        verdictTitle.textContent = "Session Complete";
        verdictLine.textContent = "You secured " + state.bails + " bails out of " + state.totalCases + ".";
        verdictPoints.textContent = String(state.score);
        verdictFeedback.textContent = "Export the log for analysis, or restart to play again.";
        btnNext.textContent = "Restart";
        showVerdictScreen();
        return;
      }

      btnNext.textContent = "Next Case";
      state.current = pickQuestion();

      caseNo.textContent = "Case #" + (state.index + 1);
      caseBrief.textContent = state.current.brief || genBrief();

      quizTitle.textContent = "Judge’s Question";
      quizSub.textContent = "Choose the best answer. One attempt only.";
      qText.textContent = state.current.q;
      qMeta.textContent =
        "Topic: " + state.current.topic +
        " • Difficulty: " + state.current.difficulty +
        " • Question ID: " + state.current.id;

      options.innerHTML = "";
      const labels = ["A","B","C","D"];
      state.current.choices.forEach((c, idx)=>{
        const b = document.createElement("button");
        b.className = "opt";
        b.type = "button";
        b.innerHTML = "<div><b>" + labels[idx] + ".</b> " + escapeHTML(c) + "</div><small>Tap to submit</small>";
        b.addEventListener("click", () => submitAnswer(idx));
        options.appendChild(b);
      });

      btnStart.textContent = "Hearings Running";
      btnStart.disabled = true;

      updateHUD();
    }

    function submitAnswer(selectedIndex){
      if(state.locked) return;
      state.locked = true;

      const btns = Array.from(options.querySelectorAll(".opt"));
      btns.forEach(b => b.disabled = true);

      const correctIdx = state.current.answerIndex;
      const correct = selectedIndex === correctIdx;

      btns.forEach((b, idx)=>{
        if(idx === correctIdx) b.classList.add("correct");
        if(idx === selectedIndex && idx !== correctIdx) b.classList.add("wrong");
        const sm = b.querySelector("small");
        if(sm){
          if(idx === correctIdx) sm.textContent = "Correct option";
          else if(idx === selectedIndex) sm.textContent = "Your selection";
          else sm.textContent = "Option";
        }
      });

      // Judge facial/manner cue immediately
      judgeManner(correct);

      // After a short beat, judge strikes the hammer (gavel)
      setTimeout(() => {
        judgeStrike();
      }, TIMING.judgeStrikeAfterMs);

      let points = 0;

      if(correct){
        points = 10;
        state.score += points;
        state.bails += 1;

        popStamp(true);
        fireConfetti();

        // Let learner notice bail moment, then client walks out
        setTimeout(() => clientSvg.classList.add("walkOut"), 420);

        verdictTitle.textContent = "Bail Granted";
        verdictLine.textContent = "Order passed. You earned " + points + " points.";
        verdictPoints.textContent = String(points);
        verdictFeedback.textContent = state.current.feedbackCorrect;
      } else {
        points = 0;
        popStamp(false);

        // Custody cage comes in slightly after the stamp
        setTimeout(() => {
          cageWrap.classList.add("show");
          cageClangSound();
        }, 420);

        verdictTitle.textContent = "Judicial Custody";
        verdictLine.textContent = "Bail denied. Remand executed.";
        verdictPoints.textContent = String(points);
        verdictFeedback.textContent = state.current.feedbackWrong;
      }

      // Prevent rushing
      btnNext.disabled = true;
      setTimeout(() => { btnNext.disabled = false; }, TIMING.enableNextAfterMs);

      logAttempt({
        caseNo: state.index + 1,
        qid: state.current.id,
        topic: state.current.topic,
        difficulty: state.current.difficulty,
        selectedIndex,
        correctIndex: correctIdx,
        correct,
        pointsAwarded: points
      });

      updateHUD();

      // Slower reveal of the verdict overlay (main fix)
      setTimeout(() => showVerdictScreen(), TIMING.showOutcomeFxMs);
    }

    function goNext(){
      if(!state.started){
        showToast("Click Start Hearings first");
        return;
      }
      if(state.index >= state.totalCases){
        resetGame();
        return;
      }
      state.index += 1;
      nextCase();
    }

    function exportLog(){
      const payload = {
        meta: {
          game: "Courtroom Bail GBL",
          version: "v2.4 (slower outcome + judge hammer strike)",
          totalCases: state.totalCases,
          exportedAt: new Date().toISOString()
        },
        results: { score: state.score, bails: state.bails },
        attempts: state.attemptLog
      };
      downloadJSON("courtroom_bail_gbl_log_" + Date.now() + ".json", payload);
      showToast("Log exported");
    }

    function toggleSound(){
      state.soundOn = !state.soundOn;
      btnSound.textContent = "Sound: " + (state.soundOn ? "On" : "Off");
      showToast("Sound " + (state.soundOn ? "enabled" : "disabled"));
      if(state.soundOn) ensureAudio();
    }

    // ===== EVENTS =====
    btnIntroStart.addEventListener("click", () => { ensureAudio(); startGame(); });
    btnStart.addEventListener("click", () => { ensureAudio(); startGame(); });
    btnNext.addEventListener("click", goNext);
    btnRestart.addEventListener("click", resetGame);
    btnExport.addEventListener("click", exportLog);
    btnSound.addEventListener("click", toggleSound);

    // ===== INIT =====
    resetGame();
  </script>
</body>
</html>
