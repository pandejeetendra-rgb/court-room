<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Courtroom Bail GBL — Single-Screen Mobile (v2.2)</title>
  <style>
    :root{
      --bg1:#070b16;
      --bg2:#0b1430;
      --stroke:rgba(255,255,255,.12);
      --ink:#eef3ff;
      --muted:#aebbe0;
      --good:#31d07c;
      --bad:#ff5d6c;
      --gold:#ffd66a;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --r:18px;

      --hudH: 60px;
      --quizH: 290px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1100px 520px at 15% -15%, rgba(106,166,255,.22), transparent 55%),
        radial-gradient(900px 520px at 95% 5%, rgba(255,214,106,.16), transparent 55%),
        radial-gradient(900px 620px at 50% 120%, rgba(49,208,124,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    .app{
      height:100%;
      max-width:1100px;
      margin:0 auto;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    /* HUD */
    .hud{
      height: var(--hudH);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .brand{display:flex; align-items:center; gap:10px; min-width: 240px;}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 55%),
        linear-gradient(135deg, rgba(106,166,255,.95), rgba(49,208,124,.85));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo:after{
      content:"";
      position:absolute; inset:-40% -20%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,.22), transparent);
      transform: rotate(20deg);
      animation: sheen 5s linear infinite;
    }
    @keyframes sheen{0%{transform:translateX(-45%) rotate(20deg)} 100%{transform:translateX(75%) rotate(20deg)}}
    .brand h1{margin:0;font-size:16px;font-weight:900;letter-spacing:.2px}
    .brand p{margin:2px 0 0;font-size:12px;color:var(--muted)}
    .hudRight{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; width:100%;}
    .pill{
      display:flex; align-items:center; gap:7px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      box-shadow: 0 12px 22px rgba(0,0,0,.18);
      backdrop-filter: blur(8px);
    }
    .pill b{font-size:12.5px}
    .pill span{font-size:12px;color:var(--muted);font-weight:700}

    /* Main stage */
    .stage{
      position:relative;
      flex:1 1 auto;
      min-height: 460px;
      border-radius: var(--r);
      border:1px solid var(--stroke);
      background:
        radial-gradient(900px 340px at 50% -10%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(900px 520px at 50% 120%, rgba(0,0,0,.38), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* Scene */
    .scene{position:absolute; inset:0 0 var(--quizH) 0; padding:12px;}
    .sceneInner{
      position:relative;
      height:100%;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(700px 260px at 50% -20%, rgba(106,166,255,.16), transparent 60%),
        linear-gradient(180deg, rgba(15,26,51,.5), rgba(10,16,30,.88));
      overflow:hidden;
    }
    .floor{
      position:absolute; left:-12%; right:-12%; bottom:-42%;
      height:74%;
      background: linear-gradient(180deg, rgba(255,214,106,.14), rgba(255,214,106,.05));
      transform: skewY(-6deg);
      border-top:1px solid rgba(255,255,255,.08);
    }
    .bench{
      position:absolute; top:44px; left:50%;
      transform: translateX(-50%);
      width:min(640px, 92%);
      height:160px;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(106,68,38,.90), rgba(50,28,16,.92));
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 42px rgba(0,0,0,.35);
    }
    .bench:before{
      content:"";
      position:absolute; left:18px; right:18px; top:14px;
      height:28px;
      border-radius: 16px;
      background: linear-gradient(90deg, rgba(255,255,255,.14), rgba(255,255,255,.03));
    }

    .caseLabel{
      position:absolute;
      top:12px; left:12px; right:12px;
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      pointer-events:none;
    }
    .caseBadge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 26px rgba(0,0,0,.25);
      max-width: 72%;
    }
    .caseBadge b{font-size:12.5px}
    .caseBadge span{
      font-size:12px;
      color:var(--muted);
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }

    /* Characters */
    .char{
      position:absolute;
      bottom:86px;
      width:170px;
      height:200px;
      filter: drop-shadow(0 18px 22px rgba(0,0,0,.35));
      transform-origin: 50% 100%;
    }
    .lawyer{left:18px}
    .client{right:18px}

    /* Role labels */
    .roleTag{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top:-14px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.30);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.92);
      font-weight:900;
      font-size:12px;
      letter-spacing:.2px;
      white-space:nowrap;
      box-shadow: 0 12px 22px rgba(0,0,0,.22);
      pointer-events:none;
    }
    .roleTag small{color:var(--muted); font-weight:800; margin-left:6px}
    .roleTag.judge{top:6px}

    @media (max-width: 520px){
      :root{ --quizH: 310px; }
      .char{width:150px;height:185px; bottom:84px}
      .lawyer{left:6px}
      .client{right:6px}
      .bench{top:46px;height:155px}
      .roleTag{font-size:11.5px}
    }

    /* Judge */
    .judgeWrap{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top:0;
      width:240px;
      height:240px;
      pointer-events:none;
      filter: drop-shadow(0 18px 22px rgba(0,0,0,.35));
    }
    .judge{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top:10px;
      width:210px;
      height:220px;
    }

    /* Gavel */
    .gavel{
      position:absolute;
      top:88px;
      right:18px;
      width:84px;
      height:84px;
      transform-origin: 60% 60%;
      opacity:.95;
      filter: drop-shadow(0 14px 18px rgba(0,0,0,.35));
      pointer-events:none;
    }
    .gavel.tap{animation: gavelTap .42s ease}
    @keyframes gavelTap{
      0%{transform: rotate(0deg) translateY(0)}
      35%{transform: rotate(-16deg) translateY(-7px)}
      65%{transform: rotate(10deg) translateY(2px)}
      100%{transform: rotate(0deg) translateY(0)}
    }
    /* Gavel spark */
    .gavelSpark{
      position:absolute;
      right:42px;
      top:128px;
      width:10px;height:10px;
      border-radius: 999px;
      background: rgba(255,214,106,.95);
      box-shadow: 0 0 18px rgba(255,214,106,.85);
      opacity:0;
      pointer-events:none;
    }
    .gavelSpark.show{animation: spark .32s ease}
    @keyframes spark{
      0%{opacity:0; transform: scale(.6)}
      35%{opacity:1; transform: scale(1.8)}
      100%{opacity:0; transform: scale(2.2)}
    }

    /* Verdict screen */
    .verdictScreen{
      position:absolute;
      inset:0;
      background:
        radial-gradient(700px 300px at 50% 0%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.52), rgba(0,0,0,.78));
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      z-index: 30;
    }
    .verdictScreen.show{display:flex}
    .verdictCard{
      width:min(680px, 96%);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,20,40,.62);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 50px rgba(0,0,0,.45);
      overflow:hidden;
      position:relative;
    }
    .verdictTop{
      padding:14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .verdictTop h2{margin:0;font-size:16px;font-weight:950;letter-spacing:.2px}
    .verdictTop p{margin:6px 0 0;color:var(--muted);font-size:12.5px;line-height:1.35}
    .verdictBody{padding:14px;border-top:1px solid rgba(255,255,255,.10);display:grid;gap:10px}
    .feedbackBox{
      padding:12px;border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size:12.5px;
      line-height:1.4;
    }
    .verdictActions{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; padding:14px; border-top:1px solid rgba(255,255,255,.10)}
    .sealCorner{
      position:absolute;
      right:14px;
      bottom:64px;
      width:86px;
      height:86px;
      opacity:.92;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.35));
      pointer-events:none;
      transform: rotate(-8deg);
    }

    /* Scene stamp with seal */
    .stamp{
      position:absolute;
      left:50%;
      top:52%;
      transform: translate(-50%,-50%) rotate(-8deg) scale(.9);
      padding:12px 14px;
      border-radius: 18px;
      border:2px dashed rgba(255,255,255,.35);
      background: rgba(0,0,0,.30);
      font-weight:950;
      letter-spacing: 1px;
      text-transform: uppercase;
      display:none;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      z-index: 10;
      width:min(360px, 92%);
    }
    .stampRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .stampText{font-size:14px}
    .stampSub{margin-top:6px; font-size:12px; color:var(--muted); font-weight:800; letter-spacing:.2px}
    .stamp.good{color: rgba(49,208,124,.98); border-color: rgba(49,208,124,.8)}
    .stamp.bad{color: rgba(255,93,108,.98); border-color: rgba(255,93,108,.8)}
    .stamp.show{display:block; animation: stampPop .48s ease}
    @keyframes stampPop{
      0%{opacity:0; transform: translate(-50%,-50%) rotate(-14deg) scale(.55)}
      65%{opacity:1; transform: translate(-50%,-50%) rotate(-8deg) scale(1.06)}
      100%{opacity:1; transform: translate(-50%,-50%) rotate(-8deg) scale(1)}
    }
    .seal{
      width:74px;height:74px; flex:0 0 auto;
      opacity:.95;
    }

    /* Confetti */
    .confetti{position:absolute; inset:0; pointer-events:none; overflow:hidden; display:none; z-index: 11;}
    .confetti.show{display:block}
    .confetti i{position:absolute; top:-10%; width:10px; height:16px; border-radius: 3px; opacity:.92; animation: fall 1.15s linear forwards;}
    @keyframes fall{0%{transform: translateY(-10vh) rotate(0deg); opacity:1} 100%{transform: translateY(120vh) rotate(260deg); opacity:.88}}

    /* Custody (more impressive) */
    .custodyOverlay{
      position:absolute;
      right:10px;
      bottom:72px;
      width:220px;
      height:250px;
      pointer-events:none;
      opacity:0;
      transform: translateX(26px);
      z-index: 12;
    }
    @media (max-width:520px){.custodyOverlay{width:190px;height:230px; right:4px}}
    .custodyOverlay.show{
      opacity:1;
      transform: translateX(0);
      animation: custodyIn .38s ease;
    }
    @keyframes custodyIn{from{opacity:0; transform: translateX(30px) scale(.98)} to{opacity:1; transform: translateX(0) scale(1)}}

    /* siren flash */
    .sirenFlash{
      position:absolute; inset:0;
      border-radius: 22px;
      opacity:0;
      background:
        radial-gradient(220px 180px at 25% 15%, rgba(60,150,255,.22), transparent 55%),
        radial-gradient(220px 180px at 75% 15%, rgba(255,80,110,.22), transparent 55%);
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .custodyOverlay.show .sirenFlash{
      animation: siren 1.2s ease-in-out 1;
    }
    @keyframes siren{
      0%{opacity:0}
      15%{opacity:1}
      30%{opacity:.25}
      45%{opacity:1}
      60%{opacity:.25}
      75%{opacity:1}
      100%{opacity:0}
    }

    .barsFrame{
      position:absolute; inset:0;
      border-radius: 22px;
      background: rgba(0,0,0,.34);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 40px rgba(0,0,0,.42);
      overflow:hidden;
    }
    .bars{
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(
          90deg,
          rgba(255,255,255,.18) 0,
          rgba(255,255,255,.18) 8px,
          rgba(0,0,0,.22) 8px,
          rgba(0,0,0,.22) 20px
        );
      opacity:.82;
      transform: translateY(-120%);
    }
    .custodyOverlay.show .bars{animation: barsDrop .55s cubic-bezier(.2,.85,.2,1) forwards;}
    @keyframes barsDrop{to{transform: translateY(0)}}

    /* escort silhouettes */
    .escort{
      position:absolute;
      left:0; right:0;
      bottom:54px;
      height:120px;
      opacity:0;
      transform: translateX(18px);
      pointer-events:none;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      padding:0 10px;
      gap:8px;
    }
    .custodyOverlay.show .escort{
      opacity:1;
      transform: translateX(0);
      animation: escortIn .55s ease forwards;
    }
    @keyframes escortIn{
      0%{opacity:0; transform: translateX(22px)}
      100%{opacity:1; transform: translateX(0)}
    }
    .cop{
      width:54px; height:110px;
      border-radius: 18px;
      background:
        radial-gradient(circle at 40% 20%, rgba(255,255,255,.18), transparent 55%),
        linear-gradient(180deg, rgba(70,120,255,.55), rgba(10,10,18,.75));
      border:1px solid rgba(255,255,255,.10);
      position:relative;
      box-shadow: 0 10px 18px rgba(0,0,0,.25);
    }
    .cop:before{
      content:"";
      position:absolute;
      left:50%; top:10px;
      width:24px; height:24px;
      transform: translateX(-50%);
      border-radius: 999px;
      background: rgba(240,240,255,.35);
      border:1px solid rgba(255,255,255,.10);
    }
    .cop:after{
      content:"";
      position:absolute;
      left:50%; top:38px;
      width:34px; height:12px;
      transform: translateX(-50%);
      border-radius: 999px;
      background: rgba(255,214,106,.35);
      border:1px solid rgba(255,255,255,.10);
      opacity:.8;
    }

    .cuffs{
      position:absolute;
      left:50%;
      bottom:18px;
      transform: translateX(-50%);
      width:72px;height:34px;
      opacity:0;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.30));
    }
    .custodyOverlay.show .cuffs{
      opacity:1;
      animation: cuffsPop .55s ease .12s forwards;
    }
    @keyframes cuffsPop{
      0%{transform: translateX(-50%) scale(.6); opacity:0}
      60%{transform: translateX(-50%) scale(1.15); opacity:1}
      100%{transform: translateX(-50%) scale(1); opacity:1}
    }

    .custodyTag{
      position:absolute; left:12px; right:12px; bottom:12px;
      padding:10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      color: rgba(255,93,108,.95);
      font-weight:950;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 12px;
      text-align:center;
    }
    .custodySmall{
      position:absolute;
      left:12px; right:12px;
      bottom:46px;
      padding:8px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-weight:800;
      font-size:12px;
      text-align:center;
      opacity:.95;
    }

    /* Bail: client walks out */
    .client.walkOut{ animation: walkOut 1.1s ease forwards; }
    @keyframes walkOut{0%{transform: translateX(0) scale(1)} 35%{transform: translateX(-18px) scale(1.02)} 100%{transform: translateX(-180px) scale(1.02); opacity:0}}
    @media (max-width:520px){@keyframes walkOut{0%{transform: translateX(0) scale(1)} 35%{transform: translateX(-14px) scale(1.02)} 100%{transform: translateX(-140px) scale(1.02); opacity:0}}}

    /* Quiz panel */
    .quiz{
      position:absolute;
      left:0; right:0; bottom:0;
      height: var(--quizH);
      border-top:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 240px at 20% 0%, rgba(106,166,255,.12), transparent 60%),
        radial-gradient(900px 240px at 80% 0%, rgba(255,214,106,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.28));
      backdrop-filter: blur(10px);
      padding:12px;
      z-index: 20;
    }
    .quizTop{display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap;}
    .quizTop h2{margin:0;font-size:14px;font-weight:950;letter-spacing:.2px}
    .quizTop p{margin:6px 0 0;color:var(--muted);font-size:12.5px;line-height:1.35}
    .btnRow{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}

    .btn{
      appearance:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.07);
      color:var(--ink);
      padding:9px 11px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:850;
      letter-spacing:.2px;
      transition: transform .06s ease, background .18s ease, border-color .18s ease;
      user-select:none;
    }
    .btn:hover{background: rgba(255,255,255,.10)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(106,166,255,.95), rgba(49,208,124,.85));
      border-color: rgba(255,255,255,.18);
      color:#061021;
    }
    .btn.warn{
      background: linear-gradient(135deg, rgba(255,214,106,.95), rgba(255,120,106,.85));
      border-color: rgba(255,255,255,.18);
      color:#1a0c05;
    }
    .btn:disabled{opacity:.55; cursor:not-allowed; transform:none}

    .qBox{
      margin-top:10px;
      padding:12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
    }
    .qText{margin:0;font-size:14px;font-weight:850;line-height:1.35}
    .meta{margin:8px 0 0;font-size:12px;color:var(--muted);font-weight:700}

    .options{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width:520px){.options{grid-template-columns:1fr}}
    .opt{
      text-align:left;
      padding:12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      transition: background .18s ease, transform .06s ease, border-color .18s ease;
      font-weight:850;
      color:var(--ink);
      min-height: 52px;
    }
    .opt:hover{background: rgba(255,255,255,.10)}
    .opt:active{transform: translateY(1px)}
    .opt small{display:block;margin-top:6px;color:var(--muted);font-weight:700;line-height:1.35;font-size:12px}
    .opt.correct{border-color: rgba(49,208,124,.75); background: rgba(49,208,124,.10)}
    .opt.wrong{border-color: rgba(255,93,108,.75); background: rgba(255,93,108,.10)}

    /* Intro overlay */
    .intro{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
      z-index: 40;
      background:
        radial-gradient(800px 340px at 50% 0%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.52), rgba(0,0,0,.80));
    }
    .introCard{
      width:min(760px, 96%);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,20,40,.62);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 50px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .introTop{padding:14px}
    .introTop h2{margin:0;font-size:16px;font-weight:950}
    .introTop p{margin:8px 0 0;color:var(--muted);font-size:12.5px;line-height:1.45}
    .introBody{padding:14px;border-top:1px solid rgba(255,255,255,.10);display:grid;gap:10px}
    .ruleBox{
      padding:12px;border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color:var(--muted);
      font-size:12.5px;
      line-height:1.45;
    }
    .introActions{padding:14px;border-top:1px solid rgba(255,255,255,.10);display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.14);
      color:var(--ink);
      padding:10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      display:none;
      backdrop-filter: blur(8px);
      font-weight:900;
      letter-spacing:.2px;
      z-index: 100;
    }
    .toast.show{display:block; animation: toastIn .22s ease}
    @keyframes toastIn{from{opacity:0; transform: translateX(-50%) translateY(8px)} to{opacity:1; transform: translateX(-50%) translateY(0)}}

    @media (prefers-reduced-motion: reduce){
      *{animation:none !important; transition:none !important}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="hud">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Courtroom Bail GBL</h1>
          <p>Single-screen quiz + scene. One attempt per question.</p>
        </div>
      </div>

      <div class="hudRight">
        <div class="pill"><b>Case</b> <span id="hudCase">0 / 10</span></div>
        <div class="pill"><b>Score</b> <span id="hudScore">0</span></div>
        <div class="pill"><b>Bails</b> <span id="hudBails">0</span></div>
      </div>
    </div>

    <div class="stage">

      <div class="scene">
        <div class="sceneInner">
          <div class="caseLabel">
            <div class="caseBadge">
              <b id="caseNo">Case #1</b>
              <span id="caseBrief">Case brief will appear here.</span>
            </div>
          </div>

          <div class="bench"></div>

          <!-- Judge + label -->
          <div class="judgeWrap" aria-hidden="true">
            <div class="roleTag judge">Judge <small>(Court)</small></div>
            <svg class="judge" viewBox="0 0 220 240">
              <defs>
                <linearGradient id="jg_robe" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#222433" stop-opacity=".98"/>
                  <stop offset="1" stop-color="#0d0e14" stop-opacity=".96"/>
                </linearGradient>
                <radialGradient id="jg_face" cx=".35" cy=".35" r=".75">
                  <stop offset="0" stop-color="#ffffff" stop-opacity=".35"/>
                  <stop offset=".55" stop-color="#e6d4bf" stop-opacity=".96"/>
                  <stop offset="1" stop-color="#bda88d" stop-opacity=".92"/>
                </radialGradient>
                <linearGradient id="jg_wig" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#f5f5ff" stop-opacity=".98"/>
                  <stop offset="1" stop-color="#cfd2ee" stop-opacity=".86"/>
                </linearGradient>
              </defs>
              <path d="M60 52 C60 25, 160 25, 160 52
                       C170 60, 178 78, 170 96
                       C162 110, 58 110, 50 96
                       C40 78, 48 60, 60 52Z"
                    fill="url(#jg_wig)" opacity=".95"/>
              <circle cx="110" cy="78" r="32" fill="url(#jg_face)" stroke="rgba(0,0,0,.14)" stroke-width="1"/>
              <circle cx="98" cy="76" r="3.2" fill="rgba(0,0,0,.45)"/>
              <circle cx="122" cy="76" r="3.2" fill="rgba(0,0,0,.45)"/>
              <path d="M98 92 Q110 102 122 92" fill="none" stroke="rgba(0,0,0,.35)" stroke-width="2" stroke-linecap="round"/>
              <path d="M70 112
                       C78 104, 92 98, 110 98
                       C128 98, 142 104, 150 112
                       L166 196
                       C140 214, 80 214, 54 196Z"
                    fill="url(#jg_robe)" stroke="rgba(255,255,255,.08)" stroke-width="1.2"/>
              <rect x="86" y="140" width="48" height="8" rx="8" fill="rgba(255,214,106,.85)" opacity=".65"/>
            </svg>
          </div>

          <!-- Lawyer + label -->
          <div class="char lawyer" aria-hidden="true">
            <div class="roleTag">Lawyer <small>(Defence)</small></div>
            <svg viewBox="0 0 180 220" width="100%" height="100%">
              <defs>
                <radialGradient id="lw_face" cx=".35" cy=".35" r=".75">
                  <stop offset="0" stop-color="#ffffff" stop-opacity=".30"/>
                  <stop offset=".55" stop-color="#ead7c2" stop-opacity=".96"/>
                  <stop offset="1" stop-color="#c3a78a" stop-opacity=".92"/>
                </radialGradient>
                <linearGradient id="lw_suit" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#7db7ff" stop-opacity=".98"/>
                  <stop offset="1" stop-color="#2b4aa7" stop-opacity=".92"/>
                </linearGradient>
                <linearGradient id="lw_hair" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#23263a" stop-opacity=".95"/>
                  <stop offset="1" stop-color="#0e0f16" stop-opacity=".95"/>
                </linearGradient>
              </defs>
              <rect x="110" y="140" width="38" height="52" rx="10" fill="rgba(255,214,106,.85)" opacity=".65" stroke="rgba(255,255,255,.10)"/>
              <circle cx="78" cy="70" r="26" fill="url(#lw_face)" stroke="rgba(0,0,0,.12)"/>
              <path d="M52 72 C54 45, 102 42, 106 70
                       C98 58, 78 54, 60 62
                       C56 66, 54 70, 52 72Z"
                    fill="url(#lw_hair)" opacity=".98"/>
              <path d="M40 102
                       C50 92, 64 86, 78 86
                       C92 86, 106 92, 116 102
                       L132 198
                       C104 214, 52 214, 24 198Z"
                    fill="url(#lw_suit)" stroke="rgba(255,255,255,.10)" stroke-width="1.2"/>
              <path d="M78 98 L88 118 L78 132 L68 118 Z" fill="rgba(255,255,255,.22)"/>
              <path d="M78 132 L90 180 L66 180 Z" fill="rgba(255,255,255,.14)"/>
            </svg>
          </div>

          <!-- Client + label -->
          <div class="char client" id="clientWrap" aria-hidden="true">
            <div class="roleTag">Client <small>(Accused)</small></div>
            <svg id="clientSvg" viewBox="0 0 180 220" width="100%" height="100%">
              <defs>
                <radialGradient id="cl_face" cx=".35" cy=".35" r=".75">
                  <stop offset="0" stop-color="#ffffff" stop-opacity=".30"/>
                  <stop offset=".55" stop-color="#ead7c2" stop-opacity=".96"/>
                  <stop offset="1" stop-color="#c3a78a" stop-opacity=".92"/>
                </radialGradient>
                <linearGradient id="cl_shirt" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#ff86a4" stop-opacity=".92"/>
                  <stop offset="1" stop-color="#7b2140" stop-opacity=".88"/>
                </linearGradient>
                <linearGradient id="cl_hair" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="#2a2a2f" stop-opacity=".95"/>
                  <stop offset="1" stop-color="#0f0f14" stop-opacity=".95"/>
                </linearGradient>
              </defs>
              <circle cx="100" cy="72" r="26" fill="url(#cl_face)" stroke="rgba(0,0,0,.12)"/>
              <path d="M78 72 C80 46, 128 44, 130 72
                       C118 58, 96 56, 82 64
                       C80 66, 79 69, 78 72Z"
                    fill="url(#cl_hair)" opacity=".98"/>
              <path d="M62 102
                       C72 92, 86 86, 100 86
                       C114 86, 128 92, 138 102
                       L154 198
                       C126 214, 74 214, 46 198Z"
                    fill="url(#cl_shirt)" stroke="rgba(255,255,255,.10)" stroke-width="1.2"/>
              <circle cx="62" cy="152" r="10" fill="rgba(234,215,194,.92)" opacity=".95"/>
              <circle cx="144" cy="152" r="10" fill="rgba(234,215,194,.92)" opacity=".95"/>
            </svg>
          </div>

          <!-- Gavel -->
          <svg class="gavel" id="gavel" viewBox="0 0 120 120" aria-hidden="true">
            <defs>
              <linearGradient id="gv" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="#ffd66a" stop-opacity=".70"/>
                <stop offset="1" stop-color="#ffd66a" stop-opacity=".18"/>
              </linearGradient>
            </defs>
            <rect x="18" y="26" width="42" height="24" rx="8" fill="url(#gv)" stroke="rgba(255,255,255,.14)"/>
            <rect x="40" y="42" width="60" height="18" rx="12" fill="url(#gv)" stroke="rgba(255,255,255,.12)"
                  transform="rotate(35 40 42)"/>
          </svg>
          <div class="gavelSpark" id="gavelSpark"></div>

          <!-- Scene stamp (with seal) -->
          <div class="stamp" id="stamp"></div>

          <div class="confetti" id="confetti"></div>

          <!-- Custody overlay (upgraded) -->
          <div class="custodyOverlay" id="custodyOverlay" aria-hidden="true">
            <div class="barsFrame">
              <div class="sirenFlash"></div>
              <div class="bars"></div>
              <div class="escort">
                <div class="cop"></div>
                <div class="cop" style="opacity:.85"></div>
              </div>

              <!-- handcuffs icon -->
              <svg class="cuffs" viewBox="0 0 120 60">
                <defs>
                  <linearGradient id="cu" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0" stop-color="rgba(255,255,255,.35)"/>
                    <stop offset="1" stop-color="rgba(255,255,255,.12)"/>
                  </linearGradient>
                </defs>
                <g fill="none" stroke="url(#cu)" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M28 36 a18 18 0 1 1 36 0 a18 18 0 1 1 -36 0" />
                  <path d="M56 36 h8" />
                  <path d="M56 28 h12" />
                  <path d="M72 36 a18 18 0 1 1 36 0 a18 18 0 1 1 -36 0" />
                </g>
              </svg>

              <div class="custodySmall">Escorted to lock-up</div>
              <div class="custodyTag">Judicial Custody</div>
            </div>
          </div>

          <div class="floor"></div>
        </div>
      </div>

      <!-- Quiz -->
      <div class="quiz">
        <div class="quizTop">
          <div>
            <h2 id="quizTitle">Ready</h2>
            <p id="quizSub">Start the hearings. One attempt per question.</p>
          </div>
          <div class="btnRow">
            <button class="btn" id="btnSound">Sound: On</button>
            <button class="btn" id="btnRestart">Restart</button>
            <button class="btn warn" id="btnExport">Export Log</button>
          </div>
        </div>

        <div class="qBox">
          <p class="qText" id="qText">Press “Start” to begin.</p>
          <div class="meta" id="qMeta">Topic: — • Difficulty: — • Question ID: —</div>

          <div class="options" id="options"></div>

          <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
            <button class="btn primary" id="btnStart">Start</button>
          </div>
        </div>
      </div>

      <!-- Verdict screen -->
      <div class="verdictScreen" id="verdictScreen" role="dialog" aria-modal="true">
        <div class="verdictCard">
          <div class="verdictTop">
            <div>
              <h2 id="verdictTitle">Judgment</h2>
              <p id="verdictLine">Result will appear here.</p>
            </div>
            <div class="pill" style="margin-left:auto">
              <b>Points</b> <span id="verdictPoints">0</span>
            </div>
          </div>

          <div class="verdictBody">
            <div class="feedbackBox" id="verdictFeedback">Feedback appears here.</div>
          </div>

          <!-- Corner seal -->
          <svg class="sealCorner" viewBox="0 0 120 120" aria-hidden="true">
            <defs>
              <radialGradient id="sg" cx=".35" cy=".35" r=".75">
                <stop offset="0" stop-color="rgba(255,255,255,.22)"/>
                <stop offset=".55" stop-color="rgba(255,214,106,.40)"/>
                <stop offset="1" stop-color="rgba(255,214,106,.12)"/>
              </radialGradient>
            </defs>
            <circle cx="60" cy="60" r="48" fill="none" stroke="rgba(255,214,106,.55)" stroke-width="6"/>
            <circle cx="60" cy="60" r="36" fill="url(#sg)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>
            <path d="M60 36 L67 54 L86 54 L70 65 L76 84 L60 73 L44 84 L50 65 L34 54 L53 54 Z"
                  fill="rgba(255,255,255,.18)" stroke="rgba(255,255,255,.14)" stroke-width="1.5"/>
            <text x="60" y="104" text-anchor="middle" font-size="12" font-weight="900" fill="rgba(255,214,106,.85)">COURT SEAL</text>
          </svg>

          <div class="verdictActions">
            <button class="btn primary" id="btnNext">Next Case</button>
          </div>
        </div>
      </div>

      <!-- Intro overlay (teacher note removed) -->
      <div class="intro" id="intro">
        <div class="introCard">
          <div class="introTop">
            <h2>Bail or Custody</h2>
            <p>
              You are the defence lawyer. Each hearing has one MCQ based on the chapter.
              Correct grants bail; wrong sends the client to custody. Aim for maximum bails.
            </p>
          </div>
          <div class="introBody">
            <div class="ruleBox">
              <b>Rules</b><br/>
              • One attempt per question (no appeal).<br/>
              • Correct: +10 points and bail granted.<br/>
              • Wrong: 0 points and custody animation.<br/>
              • Scene + MCQ stay on the same screen for smartphones.
            </div>
          </div>
          <div class="introActions">
            <button class="btn primary" id="btnIntroStart">Start Hearings</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="toast" id="toast">OK</div>

  <script>
    // ===== CONFIG =====
    const TOTAL_CASES = 10;

    // Replace with your chapter-based MCQs.
    const QUESTION_BANK = [
      {
        id: "CH-Q1",
        topic: "Foundations",
        difficulty: 1,
        brief: "The accused requests bail. The judge tests your grasp of core security objectives.",
        q: "Which statement best describes the primary goal of information security?",
        choices: [
          "Ensure confidentiality, integrity, and availability of information",
          "Increase internet speed and reduce latency",
          "Replace passwords with biometrics in all systems",
          "Eliminate all risk by blocking network access"
        ],
        answerIndex: 0,
        feedbackCorrect: "Correct. The CIA triad (confidentiality, integrity, availability) is a standard framing of information security goals.",
        feedbackWrong: "Not correct. The fundamental goal is not speed or absolute risk removal; it is commonly framed using confidentiality, integrity, and availability."
      },
      {
        id: "CH-Q2",
        topic: "Threats",
        difficulty: 1,
        brief: "The prosecution cites a suspicious email trail. The judge asks about common attack intent.",
        q: "A phishing email mainly attempts to:",
        choices: [
          "Physically damage computer hardware",
          "Trick users into revealing sensitive information",
          "Upgrade the operating system automatically",
          "Encrypt backups to improve recovery"
        ],
        answerIndex: 1,
        feedbackCorrect: "Correct. Phishing is social engineering intended to deceive users into sharing credentials or sensitive data.",
        feedbackWrong: "Not correct. Phishing focuses on deception and information theft, not hardware damage or system upgrades."
      },
      {
        id: "CH-Q3",
        topic: "Controls",
        difficulty: 2,
        brief: "The judge asks what control best reduces harm if a password is compromised.",
        q: "Which control most directly reduces the impact of a compromised password?",
        choices: [
          "Multi-factor authentication (MFA)",
          "Defragmenting the hard disk",
          "Increasing screen brightness",
          "Turning off all firewalls"
        ],
        answerIndex: 0,
        feedbackCorrect: "Correct. MFA adds an additional verification factor so a password alone is insufficient.",
        feedbackWrong: "Not correct. The relevant idea is adding an extra factor beyond the password."
      },
      {
        id: "CH-Q4",
        topic: "Malware",
        difficulty: 2,
        brief: "A device was locked and access was demanded for payment. The judge asks the correct term.",
        q: "Ransomware is best described as malware that:",
        choices: [
          "Steals data silently without any visible effects",
          "Encrypts files and demands payment to restore access",
          "Only affects mobile devices and not computers",
          "Improves system security by patching vulnerabilities"
        ],
        answerIndex: 1,
        feedbackCorrect: "Correct. Ransomware commonly encrypts files and demands payment for decryption.",
        feedbackWrong: "Not correct. The defining behavior is encryption plus extortion."
      }
    ];

    const CASE_TEMPLATES = [
      "The accused requests bail. The prosecution claims a risk of repeating the offence.",
      "The accused is a first-time offender. The court seeks clarity on a relevant concept.",
      "Digital evidence is cited. You must respond using correct principles.",
      "The judge tests your reasoning before granting bail.",
      "A procedural concern is raised. Bail conditions must be justified with correct reasoning."
    ];

    // ===== STATE =====
    const state = {
      totalCases: TOTAL_CASES,
      started: false,
      index: 0,
      score: 0,
      bails: 0,
      current: null,
      attemptLog: [],
      locked: false,
      soundOn: true
    };

    // ===== DOM =====
    const $ = (id) => document.getElementById(id);
    function must(id){
      const node = $(id);
      if(!node) throw new Error("Missing element id: " + id);
      return node;
    }

    const hudCase = must("hudCase");
    const hudScore = must("hudScore");
    const hudBails = must("hudBails");

    const caseNo = must("caseNo");
    const caseBrief = must("caseBrief");

    const quizTitle = must("quizTitle");
    const quizSub = must("quizSub");

    const qText = must("qText");
    const qMeta = must("qMeta");
    const options = must("options");

    const btnSound = must("btnSound");
    const btnStart = must("btnStart");
    const btnRestart = must("btnRestart");
    const btnExport = must("btnExport");

    const intro = must("intro");
    const btnIntroStart = must("btnIntroStart");

    const gavel = must("gavel");
    const gavelSpark = must("gavelSpark");
    const stamp = must("stamp");
    const confetti = must("confetti");

    const custodyOverlay = must("custodyOverlay");
    const clientSvg = must("clientSvg");

    const verdictScreen = must("verdictScreen");
    const verdictTitle = must("verdictTitle");
    const verdictLine = must("verdictLine");
    const verdictPoints = must("verdictPoints");
    const verdictFeedback = must("verdictFeedback");
    const btnNext = must("btnNext");

    const toast = must("toast");

    // ===== SOUND (gavel effect) =====
    let audioCtx = null;
    function ensureAudio(){
      if(!state.soundOn) return null;
      if(!audioCtx){
        try{
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }catch(e){
          audioCtx = null;
        }
      }
      return audioCtx;
    }
    function gavelSound(){
      const ctx = ensureAudio();
      if(!ctx) return;

      const now = ctx.currentTime;

      // a short "thunk" + click: filtered noise + quick sine
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = "sine";
      o.frequency.setValueAtTime(220, now);
      o.frequency.exponentialRampToValueAtTime(140, now + 0.06);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.22, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.09);
      o.connect(g);
      g.connect(ctx.destination);
      o.start(now);
      o.stop(now + 0.10);

      // tiny hi-click
      const o2 = ctx.createOscillator();
      const g2 = ctx.createGain();
      o2.type = "triangle";
      o2.frequency.setValueAtTime(900, now);
      g2.gain.setValueAtTime(0.0001, now);
      g2.gain.exponentialRampToValueAtTime(0.08, now + 0.005);
      g2.gain.exponentialRampToValueAtTime(0.0001, now + 0.035);
      o2.connect(g2);
      g2.connect(ctx.destination);
      o2.start(now);
      o2.stop(now + 0.04);
    }

    // ===== HELPERS =====
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1100);
    }

    function escapeHTML(str){
      const s = String(str);
      return s
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }

    function tapGavel(){
      gavel.classList.remove("tap");
      gavelSpark.classList.remove("show");
      void gavel.offsetWidth;
      gavel.classList.add("tap");
      gavelSpark.classList.add("show");
      gavelSound();
    }

    function resetSceneFX(){
      stamp.className = "stamp";
      stamp.innerHTML = "";
      confetti.className = "confetti";
      confetti.innerHTML = "";
      custodyOverlay.classList.remove("show");
      clientSvg.classList.remove("walkOut");
      clientSvg.style.opacity = "";
      clientSvg.style.transform = "";
      state.locked = false;

      const btns = options.querySelectorAll(".opt");
      for(const b of btns){
        b.classList.remove("correct","wrong");
        b.disabled = false;
        const sm = b.querySelector("small");
        if(sm) sm.textContent = "Tap to submit";
      }
    }

    function sealSVG(labelTop, labelBottom){
      return `
        <svg class="seal" viewBox="0 0 120 120" aria-hidden="true">
          <defs>
            <radialGradient id="sealG" cx=".35" cy=".35" r=".75">
              <stop offset="0" stop-color="rgba(255,255,255,.22)"/>
              <stop offset=".55" stop-color="rgba(255,214,106,.40)"/>
              <stop offset="1" stop-color="rgba(255,214,106,.12)"/>
            </radialGradient>
          </defs>
          <circle cx="60" cy="60" r="48" fill="none" stroke="rgba(255,214,106,.55)" stroke-width="6"/>
          <circle cx="60" cy="60" r="36" fill="url(#sealG)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>
          <path d="M60 36 L67 54 L86 54 L70 65 L76 84 L60 73 L44 84 L50 65 L34 54 L53 54 Z"
                fill="rgba(255,255,255,.18)" stroke="rgba(255,255,255,.14)" stroke-width="1.5"/>
          <text x="60" y="22" text-anchor="middle" font-size="10.5" font-weight="900" fill="rgba(255,214,106,.9)">${labelTop}</text>
          <text x="60" y="106" text-anchor="middle" font-size="10.5" font-weight="900" fill="rgba(255,214,106,.9)">${labelBottom}</text>
        </svg>
      `;
    }

    function popStamp(isGood){
      stamp.className = "stamp " + (isGood ? "good" : "bad") + " show";
      const big = isGood ? "BAIL GRANTED" : "JUDICIAL CUSTODY";
      const sub = isGood ? "Order: Release on conditions" : "Order: Remand to custody";
      const seal = sealSVG("COURT", "SEAL");
      stamp.innerHTML = `
        <div class="stampRow">
          <div>
            <div class="stampText">${big}</div>
            <div class="stampSub">${sub}</div>
          </div>
          ${seal}
        </div>
      `;
    }

    function fireConfetti(){
      confetti.innerHTML = "";
      const pieces = 26;
      for(let i=0;i<pieces;i++){
        const p = document.createElement("i");
        p.style.left = (Math.random()*100) + "%";
        p.style.animationDelay = (Math.random()*0.12) + "s";
        const hue = Math.floor(Math.random()*360);
        p.style.background = "hsla(" + hue + ", 85%, 65%, .95)";
        p.style.width = (8 + Math.random()*6) + "px";
        p.style.height = (10 + Math.random()*10) + "px";
        confetti.appendChild(p);
      }
      confetti.classList.add("show");
      setTimeout(()=> confetti.classList.remove("show"), 1400);
    }

    function showVerdictScreen(){ verdictScreen.classList.add("show"); }
    function hideVerdictScreen(){ verdictScreen.classList.remove("show"); }

    function updateHUD(){
      const caseText = state.started ? ((state.index + 1) + " / " + state.totalCases) : ("0 / " + state.totalCases);
      hudCase.textContent = caseText;
      hudScore.textContent = String(state.score);
      hudBails.textContent = String(state.bails);
    }

    function genBrief(){
      return CASE_TEMPLATES[state.index % CASE_TEMPLATES.length];
    }

    function pickQuestion(){
      return QUESTION_BANK[state.index % QUESTION_BANK.length];
    }

    function logAttempt(entry){
      state.attemptLog.push({ ts: new Date().toISOString(), ...entry });
    }

    function downloadJSON(filename, obj){
      const blob = new Blob([JSON.stringify(obj, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 800);
    }

    // ===== FLOW =====
    function resetGame(){
      state.started = false;
      state.index = 0;
      state.score = 0;
      state.bails = 0;
      state.current = null;
      state.attemptLog = [];
      state.locked = false;

      hideVerdictScreen();
      intro.style.display = "flex";

      quizTitle.textContent = "Ready";
      quizSub.textContent = "Start the hearings. One attempt per question.";
      qText.textContent = "Press “Start” to begin.";
      qMeta.textContent = "Topic: — • Difficulty: — • Question ID: —";
      options.innerHTML = "";

      btnStart.textContent = "Start";
      btnStart.disabled = false;

      caseNo.textContent = "Case #1";
      caseBrief.textContent = "Case brief will appear here.";

      updateHUD();
      resetSceneFX();
    }

    function startGame(){
      state.started = true;
      state.index = 0;
      state.score = 0;
      state.bails = 0;
      state.attemptLog = [];
      intro.style.display = "none";
      nextCase();
    }

    function nextCase(){
      hideVerdictScreen();
      resetSceneFX();

      if(state.index >= state.totalCases){
        verdictTitle.textContent = "Session Complete";
        verdictLine.textContent = "You secured " + state.bails + " bails out of " + state.totalCases + ".";
        verdictPoints.textContent = String(state.score);
        verdictFeedback.textContent = "Export the log for analysis, or restart to play again.";
        btnNext.textContent = "Restart";
        showVerdictScreen();
        return;
      }

      btnNext.textContent = "Next Case";
      state.current = pickQuestion();

      caseNo.textContent = "Case #" + (state.index + 1);
      caseBrief.textContent = state.current.brief || genBrief();

      quizTitle.textContent = "Judge’s Question";
      quizSub.textContent = "Choose the best answer. One attempt only.";
      qText.textContent = state.current.q;
      qMeta.textContent =
        "Topic: " + state.current.topic +
        " • Difficulty: " + state.current.difficulty +
        " • Question ID: " + state.current.id;

      options.innerHTML = "";
      const labels = ["A","B","C","D"];
      state.current.choices.forEach((c, idx)=>{
        const b = document.createElement("button");
        b.className = "opt";
        b.type = "button";
        b.innerHTML = "<div><b>" + labels[idx] + ".</b> " + escapeHTML(c) + "</div><small>Tap to submit</small>";
        b.addEventListener("click", () => submitAnswer(idx));
        options.appendChild(b);
      });

      btnStart.textContent = "Hearings Running";
      btnStart.disabled = true;

      updateHUD();
    }

    function submitAnswer(selectedIndex){
      if(state.locked) return;
      state.locked = true;

      const btns = Array.from(options.querySelectorAll(".opt"));
      btns.forEach(b => b.disabled = true);

      const correctIdx = state.current.answerIndex;
      const correct = selectedIndex === correctIdx;

      btns.forEach((b, idx)=>{
        if(idx === correctIdx) b.classList.add("correct");
        if(idx === selectedIndex && idx !== correctIdx) b.classList.add("wrong");
        const sm = b.querySelector("small");
        if(sm){
          if(idx === correctIdx) sm.textContent = "Correct option";
          else if(idx === selectedIndex) sm.textContent = "Your selection";
          else sm.textContent = "Option";
        }
      });

      tapGavel();

      let points = 0;
      if(correct){
        points = 10;
        state.score += points;
        state.bails += 1;

        popStamp(true);
        fireConfetti();
        setTimeout(()=> clientSvg.classList.add("walkOut"), 220);

        verdictTitle.textContent = "Bail Granted";
        verdictLine.textContent = "Order passed. You earned " + points + " points.";
        verdictPoints.textContent = String(points);
        verdictFeedback.textContent = state.current.feedbackCorrect;
      } else {
        points = 0;

        popStamp(false);
        // stronger custody reveal
        setTimeout(()=> custodyOverlay.classList.add("show"), 150);

        verdictTitle.textContent = "Judicial Custody";
        verdictLine.textContent = "Bail denied. Remand ordered.";
        verdictPoints.textContent = String(points);
        verdictFeedback.textContent = state.current.feedbackWrong;
      }

      logAttempt({
        caseNo: state.index + 1,
        qid: state.current.id,
        topic: state.current.topic,
        difficulty: state.current.difficulty,
        selectedIndex,
        correctIndex: correctIdx,
        correct,
        pointsAwarded: points
      });

      updateHUD();
      setTimeout(()=> showVerdictScreen(), 850);
    }

    function goNext(){
      if(!state.started){
        showToast("Click Start Hearings first");
        return;
      }
      if(state.index >= state.totalCases){
        resetGame();
        return;
      }
      state.index += 1;
      nextCase();
    }

    function exportLog(){
      const payload = {
        meta: {
          game: "Courtroom Bail GBL",
          version: "v2.2 (labels + seal + stronger custody + gavel sound)",
          totalCases: state.totalCases,
          exportedAt: new Date().toISOString()
        },
        results: { score: state.score, bails: state.bails },
        attempts: state.attemptLog
      };
      downloadJSON("courtroom_bail_gbl_log_" + Date.now() + ".json", payload);
      showToast("Log exported");
    }

    function toggleSound(){
      state.soundOn = !state.soundOn;
      btnSound.textContent = "Sound: " + (state.soundOn ? "On" : "Off");
      showToast("Sound " + (state.soundOn ? "enabled" : "disabled"));
      // if turning on, prime audio context on user gesture
      if(state.soundOn) ensureAudio();
    }

    // ===== EVENTS =====
    btnIntroStart.addEventListener("click", () => { ensureAudio(); startGame(); });
    btnStart.addEventListener("click", () => { ensureAudio(); startGame(); });
    btnNext.addEventListener("click", goNext);
    btnRestart.addEventListener("click", resetGame);
    btnExport.addEventListener("click", exportLog);
    btnSound.addEventListener("click", toggleSound);

    // ===== INIT =====
    resetGame();
  </script>
</body>
</html>
